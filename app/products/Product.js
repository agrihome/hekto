"use client";

import Link from "next/link";
import Image from "next/image";
import { useEffect, useState } from "react";
import { useDispatch } from "react-redux";
import { addToCart } from "../store/cartSlice";

export default function Product({
  product: { img, name, sellPrice, maxPrice, rating },
}) {
  const dispatch = useDispatch();
  const [addedToCart, setAddedToCart] = useState(false);

  function handleCartClick(e) {
    e.preventDefault();
    dispatch(addToCart({ name }));
    setAddedToCart(true);
  }

  useEffect(() => {
    const timeOut = setTimeout(() => {
      setAddedToCart(() => false);
    }, 2000);
  }, [addedToCart]);

  return (
    <div className="product__card">
      <Link href={`/products/${name}`}>
        <Image src={img} alt={name} className="product__img"></Image>
      </Link>

      <div className="product__details">
        <Link href={`/products/${name}`}>
          <div className="product__name title-small">{name}</div>{" "}
        </Link>

        <div className="product__rating">
          {[...Array(5)].map((val, index) => {
            return (
              <svg
                width="14"
                height="13"
                viewBox="0 0 14 13"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                key={index}
              >
                <path
                  d="M6.09749 0.891366C6.45972 0.132244 7.54028 0.132244 7.90251 0.891366L9.07038 3.33882C9.21616 3.64433 9.5066 3.85534 9.84221 3.89958L12.5308 4.25399C13.3647 4.36391 13.6986 5.39158 13.0885 5.97067L11.1218 7.83768C10.8763 8.07073 10.7653 8.41217 10.827 8.74502L11.3207 11.4115C11.4739 12.2386 10.5997 12.8737 9.86041 12.4725L7.47702 11.1789C7.1795 11.0174 6.8205 11.0174 6.52298 11.1789L4.13959 12.4725C3.40033 12.8737 2.52614 12.2386 2.67929 11.4115L3.17304 8.74502C3.23467 8.41217 3.12373 8.07073 2.87823 7.83768L0.911452 5.97067C0.301421 5.39158 0.635332 4.36391 1.46924 4.25399L4.15779 3.89958C4.4934 3.85534 4.78384 3.64433 4.92962 3.33882L6.09749 0.891366Z"
                  fill={index < rating ? "#F9BA00" : "#E5E0FC"}
                />
              </svg>
            );
          })}
        </div>

        <div className="product__price">
          <span className="sellPrice label-default">${sellPrice}</span>
          <span className="maxPrice label-small">${maxPrice}</span>
        </div>

        <p className="product__description">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Magna in est
          adipiscing in phasellus non in justo.
        </p>

        <div className="product__actions">
          {addedToCart ? (
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              xmlns="http://www.w3.org/2000/svg"
              className={addedToCart ? "tick" : ""}
            >
              <path
                d="M2 8.5L5.5 12L14 3.5"
                stroke="#7E33E0"
                strokeLinecap="round"
                strokeLinejoin="round"
                fill="none"
              />
            </svg>
          ) : (
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              onClick={handleCartClick}
            >
              <rect width="16" height="16" fill="white" />
              <path
                d="M0.999023 1.5991C0.999023 1.43995 1.06225 1.28732 1.17478 1.17478C1.28732 1.06225 1.43995 0.999023 1.5991 0.999023H2.04556C2.80566 0.999023 3.26172 1.51029 3.52175 1.98555C3.69538 2.30239 3.82099 2.66964 3.91941 3.00249C3.94602 3.00038 3.97271 2.99932 3.99942 2.99929H13.9991C14.6632 2.99929 15.1433 3.63457 14.9608 4.27385L13.4983 9.40172C13.3671 9.86167 13.0897 10.2664 12.708 10.5545C12.3263 10.8427 11.8611 10.9986 11.3828 10.9987H6.62376C6.14169 10.9988 5.67296 10.8405 5.2896 10.5482C4.90625 10.2559 4.6295 9.84579 4.50188 9.38092L3.8938 7.16303L2.88567 3.76419L2.88487 3.75778C2.76005 3.30413 2.64324 2.87927 2.46882 2.56243C2.30159 2.25439 2.16718 2.19918 2.04636 2.19918H1.5991C1.43995 2.19918 1.28732 2.13596 1.17478 2.02342C1.06225 1.91089 0.999023 1.75825 0.999023 1.5991ZM5.05795 6.87179L5.65883 9.06328C5.77885 9.49694 6.1733 9.79857 6.62376 9.79857H11.3828C11.6002 9.79857 11.8116 9.72773 11.9852 9.59679C12.1587 9.46585 12.2849 9.28193 12.3445 9.07288L13.7343 4.19944H4.26745L5.04675 6.82939L5.05795 6.87179Z"
                fill="#7E33E0"
              />
              <path
                d="M7.80003 13.4006C7.80003 13.825 7.63143 14.232 7.33134 14.5321C7.03124 14.8322 6.62422 15.0008 6.19982 15.0008C5.77542 15.0008 5.3684 14.8322 5.0683 14.5321C4.7682 14.232 4.59961 13.825 4.59961 13.4006C4.59961 12.9762 4.7682 12.5692 5.0683 12.2691C5.3684 11.969 5.77542 11.8004 6.19982 11.8004C6.62422 11.8004 7.03124 11.969 7.33134 12.2691C7.63143 12.5692 7.80003 12.9762 7.80003 13.4006ZM6.59987 13.4006C6.59987 13.2945 6.55772 13.1928 6.4827 13.1177C6.40767 13.0427 6.30592 13.0006 6.19982 13.0006C6.09372 13.0006 5.99196 13.0427 5.91694 13.1177C5.84191 13.1928 5.79977 13.2945 5.79977 13.4006C5.79977 13.5067 5.84191 13.6085 5.91694 13.6835C5.99196 13.7585 6.09372 13.8007 6.19982 13.8007C6.30592 13.8007 6.40767 13.7585 6.4827 13.6835C6.55772 13.6085 6.59987 13.5067 6.59987 13.4006Z"
                fill="#7E33E0"
              />
              <path
                d="M13.4006 13.4006C13.4006 13.825 13.232 14.232 12.9319 14.5321C12.6318 14.8322 12.2248 15.0008 11.8004 15.0008C11.376 15.0008 10.969 14.8322 10.6689 14.5321C10.3688 14.232 10.2002 13.825 10.2002 13.4006C10.2002 12.9762 10.3688 12.5692 10.6689 12.2691C10.969 11.969 11.376 11.8004 11.8004 11.8004C12.2248 11.8004 12.6318 11.969 12.9319 12.2691C13.232 12.5692 13.4006 12.9762 13.4006 13.4006ZM12.2005 13.4006C12.2005 13.2945 12.1583 13.1928 12.0833 13.1177C12.0083 13.0427 11.9065 13.0006 11.8004 13.0006C11.6943 13.0006 11.5925 13.0427 11.5175 13.1177C11.4425 13.1928 11.4004 13.2945 11.4004 13.4006C11.4004 13.5067 11.4425 13.6085 11.5175 13.6835C11.5925 13.7585 11.6943 13.8007 11.8004 13.8007C11.9065 13.8007 12.0083 13.7585 12.0833 13.6835C12.1583 13.6085 12.2005 13.5067 12.2005 13.4006Z"
                fill="#7E33E0"
              />
            </svg>
          )}

          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect width="16" height="16" fill="white" />
            <path
              d="M13.7141 3.30182C12.9713 2.55413 11.9865 2.09955 10.9387 2.02074C9.89102 1.94192 8.84997 2.24411 8.00494 2.87236C7.11474 2.20608 6.00672 1.90396 4.90401 2.02683C3.80131 2.1497 2.78582 2.68844 2.06205 3.53456C1.33828 4.38068 0.959991 5.47133 1.00336 6.58688C1.04672 7.70243 1.50852 8.76001 2.29576 9.54665L7.50818 14.7917C7.57323 14.8577 7.65061 14.9101 7.73587 14.9459C7.82113 14.9816 7.91257 15 8.00494 15C8.0973 15 8.18875 14.9816 8.27401 14.9459C8.35927 14.9101 8.43665 14.8577 8.50169 14.7917L13.7141 9.54665C14.1218 9.13671 14.4452 8.64995 14.6658 8.11419C14.8864 7.57843 15 7.00418 15 6.42424C15 5.8443 14.8864 5.27004 14.6658 4.73428C14.4452 4.19852 14.1218 3.71177 13.7141 3.30182ZM12.7276 8.55396L8.00494 13.2992L3.28227 8.55396C2.8661 8.13343 2.5826 7.59861 2.46733 7.01657C2.35207 6.43454 2.41017 5.83121 2.63436 5.28228C2.85854 4.73335 3.23882 4.26325 3.72749 3.93097C4.21616 3.59868 4.79147 3.419 5.38123 3.41447C6.16912 3.41641 6.92404 3.73293 7.4802 4.29452C7.54524 4.3605 7.62262 4.41288 7.70788 4.44862C7.79314 4.48437 7.88459 4.50277 7.97695 4.50277C8.06931 4.50277 8.16076 4.48437 8.24602 4.44862C8.33128 4.41288 8.40866 4.3605 8.47371 4.29452C9.04625 3.79527 9.7859 3.53355 10.543 3.56233C11.3 3.59111 12.0179 3.90824 12.5514 4.44954C13.0849 4.99083 13.3941 5.71586 13.4164 6.47788C13.4387 7.23989 13.1725 7.98199 12.6716 8.55396H12.7276Z"
              fill="#7E33E0"
            />
          </svg>
          <Link href={`/products/${name}`}>
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect width="16" height="16" fill="white" />
              <path
                d="M9.74982 6.83328H7.99982V5.08328C7.99982 4.92857 7.93836 4.7802 7.82897 4.6708C7.71957 4.5614 7.5712 4.49994 7.41649 4.49994C7.26178 4.49994 7.11341 4.5614 7.00401 4.6708C6.89461 4.7802 6.83316 4.92857 6.83316 5.08328V6.83328H5.08316C4.92845 6.83328 4.78007 6.89474 4.67068 7.00413C4.56128 7.11353 4.49982 7.2619 4.49982 7.41661C4.49982 7.57132 4.56128 7.71969 4.67068 7.82909C4.78007 7.93849 4.92845 7.99994 5.08316 7.99994H6.83316V9.74994C6.83316 9.90465 6.89461 10.053 7.00401 10.1624C7.11341 10.2718 7.26178 10.3333 7.41649 10.3333C7.5712 10.3333 7.71957 10.2718 7.82897 10.1624C7.93836 10.053 7.99982 9.90465 7.99982 9.74994V7.99994H9.74982C9.90453 7.99994 10.0529 7.93849 10.1623 7.82909C10.2717 7.71969 10.3332 7.57132 10.3332 7.41661C10.3332 7.2619 10.2717 7.11353 10.1623 7.00413C10.0529 6.89474 9.90453 6.83328 9.74982 6.83328ZM13.664 12.8358L11.4998 10.6891C12.3399 9.64168 12.7467 8.3122 12.6366 6.97404C12.5266 5.63587 11.908 4.39073 10.908 3.49465C9.90812 2.59857 8.60288 2.11966 7.26069 2.15639C5.91851 2.19311 4.64141 2.74269 3.69199 3.69211C2.74257 4.64153 2.19299 5.91863 2.15626 7.26082C2.11954 8.603 2.59845 9.90824 3.49453 10.9082C4.39061 11.9081 5.63575 12.5267 6.97391 12.6368C8.31208 12.7468 9.64156 12.34 10.689 11.4999L12.8357 13.6466C12.8899 13.7013 12.9544 13.7447 13.0255 13.7743C13.0966 13.8039 13.1728 13.8192 13.2498 13.8192C13.3268 13.8192 13.4031 13.8039 13.4742 13.7743C13.5452 13.7447 13.6098 13.7013 13.664 13.6466C13.7691 13.5378 13.8279 13.3925 13.8279 13.2412C13.8279 13.0899 13.7691 12.9446 13.664 12.8358ZM7.41649 11.4999C6.60888 11.4999 5.81941 11.2605 5.14791 10.8118C4.47641 10.3631 3.95304 9.72537 3.64398 8.97924C3.33492 8.2331 3.25406 7.41208 3.41162 6.61999C3.56917 5.8279 3.95807 5.10032 4.52914 4.52926C5.1002 3.95819 5.82778 3.56929 6.61987 3.41174C7.41196 3.25418 8.23298 3.33504 8.97911 3.6441C9.72525 3.95316 10.363 4.47653 10.8117 5.14803C11.2603 5.81953 11.4998 6.609 11.4998 7.41661C11.4998 8.49958 11.0696 9.53819 10.3038 10.304C9.53807 11.0697 8.49946 11.4999 7.41649 11.4999Z"
                fill="#7E33E0"
              />
            </svg>
          </Link>
        </div>
      </div>
    </div>
  );
}
